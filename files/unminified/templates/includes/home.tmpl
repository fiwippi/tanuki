{{ define "title" }}Home{{ end }}

{{ define "scripts" }}
<script type="module">
    import * as Util from {{ versioning "/static/js/util.js" }}

    document.addEventListener('alpine:init', () => {
        Alpine.data('catalog', () => ({
            search: "",
            images: [],
            entries: Util.Ensure.Array({{ catalog }}),
            progress: Util.Ensure.Object({{ catalogProgress . }}),

            get filteredEntries() {
                return this.entries.filter(
                    i => i.title.toLowerCase().startsWith(this.search.toLowerCase())
                )
            },

            async init() {
                let images = []
                await Util.Images.LoadImages(images, this.entries.length, (i) => {
                    return `/api/series/${this.entries[i].hash}/cover?thumbnail=true`
                })
                this.images = images
            },

            fmtProgress(p) {
                return `Progress: ${Util.Fmt.SeriesPercent(p)}`
            },
        }))
    })
</script>
{{ end }}

{{ define "content" }}
<div x-data="catalog">
    <template x-if="entries.length > 0">
        <h2>Library</h2>
    </template>
    <template x-if="entries.length === 0">
        <h3>Empty!</h3>
    </template>

    <template x-if="entries.length > 0">
        <div class="search">
            <input x-model="search" class="search__bar" placeholder="Search..." type="text">
        </div>
    </template>

    <div class="entries">
        <template x-for="e in filteredEntries">
            <a class="no-bottom" :href="`/entries/${e.hash}`">
                <div class="entry" style="flex: 0 1 auto; max-width: 200px">
                    <img class="entry__img" :src="images[e.order - 1].src">
                    <div class="entry__info" >
                        <h4 class="entry__title" x-text="e.title"></h4>
                        <span x-text="`Entries: ${e.entries}`"></span><br>
                        <span x-text="fmtProgress(progress[e.hash])"></span>
                    </div>
                </div>
            </a>
        </template>
    </div>
</div>
{{ end }}